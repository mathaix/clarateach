services:
  workspace:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: clarateach-workspace
    hostname: workspace
    stdin_open: true
    tty: true
    volumes:
      # Persist workspace files
      - workspace-data:/workspace
    ports:
      # Workspace server
      - "3000:3000"
    environment:
      - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY:-}
      - WORKSPACE_DIR=/workspace
      - TERM=xterm-256color
      - PORT=3000
    networks:
      - clarateach-net
    # Start the workspace server
    command: node /home/learner/server/dist/index.js

  # neko browser preview (will be configured in Story 1.3)
  # neko:
  #   image: m1k1o/neko:firefox
  #   ...

volumes:
  workspace-data:
    driver: local

networks:
  clarateach-net:
    driver: bridge
